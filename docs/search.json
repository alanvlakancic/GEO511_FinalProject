[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Euclidean Bus Mobility and Route Optimization, A Comparison",
    "section": "",
    "text": "Introduction\nThis project will use stplanr transport modeling package to design an optimal transport route for bus or cycle routes in New York City. Stplanr is a transport planning visualization R package that can be used to plan transit networks, in addition to transit planning elements such as identifying transit catchment areas, origin/destination data and ride frequency visualizations, among others. In their white paper, the devlopers of stplanr call for an accountable, transparent and democratized transit planning system that doesn’t rely on proprietary and often vastly different data sources and data processing softwares. Although the package can visualize a whole host of data, this project will focus on comparing direct desire lines or “Euclidean” routes (as the crow flies), existing bus networks and stplanr’s optimized routes. To wit: this can map the efficiency of the bus routes compared to the most direct route possible if there were no built environment factors in the way.\n\n\nMethods\nTo adequately compare desire lines, bus routes, and the most efficient routes with the current street network, this project will require at minimum three data sources. Each of these will be sourced separately and overlaid onto each other:\n\nData Source: ggmap data for basemap\n\nMethods: This can be sourced directly into R by installing the package. ggmap can bring in data from Stadiamaps. This will require a Google API key to be registered.\n\nSource: Getting Started with ggmap & Stadiamaps\n\nData Source: OpenStreetMap data for transit data, either bus or cycle routes\n\nMethods: This can be sourced directly into R by installing the package. You may need to rationalize different projection systems to make sure they overlay correctly.\n\nSource: Mapping with OpenStreetMap in R\n\nData Source: NYC Open Data for Bus Shelter locations\nDespite significant searching, there is no comprehensive bus stop dataset, so the project will focus on bus stop shelters, which are mapped via NYC Open Data.\n\nMethods: This can be brought into R as a CSV file. Each bus stop shelter has longitude and latitude coordinates that align with ggmap and OpenStreetMap projections.\n\nSource: NYC Bus Stop Shelters\n\n\n\n\nWorkflow:\n\n\nShow code\nlibrary(ggmap)\nlibrary(stplanr)\nlibrary(osmdata)\nlibrary(sf)\nlibrary(tidyverse)\nlibrary(leaflet)\nlibrary(purrr)\n\nbbox &lt;- c(left = -73.96, bottom = 40.54, right = -73.70, top = 40.81)\n#create bounding box for queens\n\nnyc_map &lt;- \"data/\"\n\n#nyc basemap, downloaded from nyc open data. source: https://search.r-project.org/CRAN/refmans/ptools/html/nyc_bor.html\n\nnyc_sf &lt;- st_read(nyc_map)\n\n\nReading layer `nybb' from data source \n  `C:\\Users\\vlakanah\\OneDrive - Alfred State College\\01. Semesters\\14. 2025 FA\\GEO511\\GEO511_FinalProject\\data' \n  using driver `ESRI Shapefile'\nSimple feature collection with 5 features and 4 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 913175.1 ymin: 120121.9 xmax: 1067383 ymax: 272844.3\nProjected CRS: NAD83 / New York Long Island (ftUS)\n\n\nShow code\n#bring in nyc_map as a sf\n\n\nshelters_sf &lt;- read_csv(\"data/Bus_Stop_Shelter_20251020.csv\")\n#NOTE: REPLACE WITH DATA WHEN USING QUARTO!\n#this brings in the bus stop shelter information. source: https://data.cityofnewyork.us/Transportation/Bus-Stop-Shelters/qafz-7myz\n\nshelters_sf_fix &lt;- st_as_sf(shelters_sf, coords = c(\"Longitude\",\"Latitude\"), crs = 4326)\n#convert to sf object with the correct coordinate reference system\n\nosmdata::set_overpass_url(\"https://overpass-api.de/api/interpreter\")\n\nosm_data &lt;- opq(bbox = bbox) %&gt;%\n  add_osm_feature(key = \"highway\", value = c(\"primary\",\"secondary\")) %&gt;%\n  osmdata_sf()\n#import data for primary and secondary highways from open street maps\n\nshelters_sf_fix &lt;- shelters_sf_fix %&gt;%\n  mutate(id = paste0(\"S\", row_number()))\n#add ID column for origin-destination pairs so they have a corresponding number\n\nflow_all &lt;- expand.grid(o = shelters_sf_fix$id, #create origin\n                        d = shelters_sf_fix$id, #create destination\n                        stringsAsFactors = FALSE) %&gt;% #make sure they aren't factors\n  filter(o != d) %&gt;% # this remove self-pairs so O is not D\n  mutate(trips = 1) %&gt;% #add trip count of 1 for each pair\n  sample_n(50) #sample 50 random paris to avoid blowing up the computer\n\ndesire_lines_all &lt;- od2line(flow_all, zones = shelters_sf_fix, zone_code = \"id\") #use od2line function to create desire lines (euclidean) for all pairs\n\nshelter_coords &lt;- shelters_sf_fix %&gt;%\n  st_coordinates() %&gt;%\n  as.data.frame() %&gt;%\n  bind_cols(id = shelters_sf_fix$id)\n#extract coordinates and bind with ID column\n\nroute_single &lt;- function(o_id, d_id) { #function to create a single route between origin and destination\n  o &lt;- shelter_coords %&gt;% filter(id == o_id) \n  #filter to get origin coordinates\n  d &lt;- shelter_coords %&gt;% filter(id == d_id)\n  #filter to get destination coordinates\n\n  r &lt;- try(route_osrm(from = c(o$X, o$Y),\n                      to   = c(d$X, d$Y)), silent = TRUE)\n#use try to catch errors  (e.g., no route found)\n  if (inherits(r, \"try-error\")) return(NULL)\n#if route found, return the route\n  return(r)\n}\n\nroutes_list &lt;- purrr::map2(flow_all$o, flow_all$d, route_single)\n#create routes for all origin-destination pairs using the route_single function\nroutes_list &lt;- routes_list[!sapply(routes_list, is.null)]\n#remove any NULL results (failed routes)\nroutes_sf &lt;- do.call(rbind, routes_list)\n#combine all routes into a single sf object\n\n\nroutes_projection &lt;- st_transform(routes_sf, 32618)\ndesire_projection &lt;- st_transform(desire_lines_all, 32618)\n#ensures the correct, projected shapefile for computation not mapping\n\nroute_length &lt;- st_length(routes_projection)\ndesire_length &lt;- st_length(desire_projection)\n#compute lengths\n\nroute_length &lt;- as.numeric(route_length)\ndesire_length &lt;- as.numeric(desire_length)\n#convert lengths to numeric values\n\nlengths_tbl &lt;- tibble(\n  route_m  = route_length,\n  desire_m = desire_length,\n  origin = flow_all$o,\n  destination = flow_all$d\n)\n#create tibble to compare lengths in the final map w/ IDs\n\nmean_route &lt;- mean(route_length, na.rm = TRUE)\nmean_desire &lt;- mean(desire_length, na.rm = TRUE)\n#calculate means for both route and desire lengths\n\npercent_change &lt;- ((mean_route - mean_desire) / mean_desire) * 100\n#calculate percent change \n\nmean_lengths &lt;- data.frame(\n  type = c(\"Route Length\", \"Desire Line Length\"),\n  mean_length_m = c(mean_route, mean_desire)\n)\n\n# Add percent change (only for Route, NA for Desire)\nmean_lengths &lt;- mean_lengths %&gt;%\n  mutate(\n    mean_length_km = mean_length_m / 1000,\n    percent_change = c(percent_change, NA)\n  )\n\n\nnyc_leaflet  &lt;- st_transform(nyc_sf, 4326)\nroads_leaflet &lt;- st_transform(osm_data$osm_lines, 4326)\ndesire_leaflet &lt;- st_transform(desire_lines_all, 4326)\nroutes_leaflet &lt;- st_transform(routes_sf, 4326)\n\ndesire_leaflet_popup &lt;- paste0(\n  \"&lt;b&gt;Desire Line&lt;/b&gt;&lt;br/&gt;\",\n  \"Origin: \", desire_leaflet$o, \"&lt;br/&gt;\",\n  \"Destination: \", desire_leaflet$d, \"&lt;br/&gt;\",\n  \"Desire Line Distance: \", round(lengths_tbl$desire_m / 1000), \" km\"\n)\n  \nroutes_leaflet_popup &lt;- paste0(\n  \"&lt;b&gt;OSRM Route&lt;/b&gt;&lt;br/&gt;\",\n  \"Origin: \", desire_leaflet$o, \"&lt;br/&gt;\",\n  \"Destination: \", desire_leaflet$d, \"&lt;br/&gt;\",\n  \"Route Distance: \", round(lengths_tbl$route_m / 1000), \" km&lt;br/&gt;\"\n)\n\npal_desire &lt;- colorNumeric(\n  palette = \"inferno\",\n  domain  = lengths_tbl$desire_m\n)\n\npal_routes &lt;- colorNumeric(\n  palette = \"inferno\",\n  domain  = lengths_tbl$route_m\n)\n\nselected_ids &lt;- unique(c(flow_all$o, flow_all$d))\n#get unique IDs of sampled shelters\n\nselected_shelters &lt;- shelters_sf_fix %&gt;% \n  filter(id %in% selected_ids)\n#filter shelters to only those that were sampled\n\nleaflet() %&gt;%\n  addProviderTiles(\"CartoDB.Positron\") %&gt;%\n  \n  addPolygons(data = nyc_leaflet,\n              color = \"black\", weight = 3,\n              fillOpacity = 0.1,\n              group = \"NYC Boundary\") %&gt;%\n  \n  # Desire lines with gradient colors\n  addPolylines(\n    data = desire_leaflet,\n    color = pal_desire(lengths_tbl$desire_m),\n    weight = 3,\n    opacity = 0.7,\n    popup = desire_leaflet_popup,\n    group = \"Desire Lines\"\n  ) %&gt;%\n  \n  # OSRM routes with gradient colors\n  addPolylines(\n    data = routes_leaflet,\n    color = pal_routes(lengths_tbl$route_m),\n    weight = 3,\n    opacity = 0.8,\n    popup = routes_leaflet_popup,\n    group = \"OSRM Routes\"\n  ) %&gt;%\n  \n  # Add color legends so users know what the gradient means\n  addLegend(\n    pal = pal_desire,\n    values = lengths_tbl$desire_m,\n    title = \"Desire Line Distance (m)\",\n    position = \"bottomright\",\n    group = \"Desire Lines\"\n  ) %&gt;%\n  \n  addLegend(\n    pal = pal_routes,\n    values = lengths_tbl$route_m,\n    title = \"OSRM Route Distance (m)\",\n    position = \"bottomleft\",\n    group = \"OSRM Routes\"\n  ) %&gt;%\n  \n  # Add shelters (same as before)\n  addCircleMarkers(data = shelters_sf_fix,\n                   color = \"blue\",\n                   radius = 1,\n                   popup = ~id,\n                   group = \"Bus Shelters\") %&gt;%\n  \n  addCircleMarkers(\n    data = selected_shelters,\n    color = \"purple\",\n    radius = 6,\n    fillOpacity = 0.9,\n    group = \"Sampled Shelters\"\n  ) %&gt;%\n  \n  addLayersControl(\n    overlayGroups = c(\"NYC Boundary\", \"Sampled Shelters\",\n                      \"Desire Lines\", \"OSRM Routes\",\n                      \"Bus Shelters\"),\n    options = layersControlOptions(collapsed = FALSE)\n  )"
  },
  {
    "objectID": "index.html#download-and-clean-all-required-data",
    "href": "index.html#download-and-clean-all-required-data",
    "title": "Analyzing Urban Mobility Patterns Using stplanr",
    "section": "Download and clean all required data",
    "text": "Download and clean all required data\n\n\nCode\nn=20\ndata=data.frame(x=runif(n,-180,180),\n                y=runif(n,-60,60),\n                size = runif(n, 5, 20),\n                category = factor(\n                  sample(letters[1:5], n, replace = TRUE)\n                  ),\n                value = rnorm(n))\n\n\n\nCode\ndata %&gt;% \n  slice(1:10) %&gt;% #show only 1:n rows\n  kable(digits=2,align=\"c\")%&gt;% #make table and round to two digits\n  kable_styling(bootstrap_options = \n                  c(\"striped\", \"hover\", \"condensed\", \"responsive\")) #apply other formatting\n\n\n\n\n\nx\ny\nsize\ncategory\nvalue\n\n\n\n\n148.18\n-28.60\n6.17\nd\n-0.37\n\n\n54.02\n23.81\n6.32\ne\n-0.41\n\n\n165.83\n-13.85\n16.35\nd\n-1.73\n\n\n174.36\n23.91\n10.55\ne\n-0.48\n\n\n116.50\n-56.81\n18.17\nd\n-0.33\n\n\n-160.48\n42.96\n5.84\na\n1.03\n\n\n35.39\n-59.37\n11.03\ne\n-1.58\n\n\n-169.40\n23.57\n12.64\nb\n-0.11\n\n\n-114.45\n58.58\n19.67\nc\n1.39\n\n\n-30.02\n-42.35\n16.95\nc\n0.09\n\n\n\n\n\n\nAdd any additional processing steps here."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n\nCode\n1 + 1\n\n\n[1] 2"
  },
  {
    "objectID": "data/Readme.html",
    "href": "data/Readme.html",
    "title": "Data Folder",
    "section": "",
    "text": "Data Folder\nPlace any data needed by your analysis in this folder. Please do not store large files here. Then read in any data using the ‘data’ path. For example, read_csv(\"data/data.csv\")."
  }
]